---
# Feel free to add content and custom Front Matter to this file.
# To modify the layout, see https://jekyllrb.com/docs/themes/#overriding-theme-defaults

layout: single
classes: wide
title: "Get Started"
permalink: /docs/get-started
sidebar:
  nav: "docs"
---
本ドキュメントは2019.2.28時点の情報です。

# はじめに
本書は、KAMONOHASHIを使用を開始する読者を対象としており、
KMAONOHASHIの中で使われている用語や、KAMONOHASHIのセットアップ方法について説明しています。

# 前提
読者は[KAMONOHASHIの構築](http://git.o.sysrdc.ns-sol.co.jp/kamonohashi/kamonohashi-deploy/blob/master/README.md#kamonohashi-%E6%A7%8B%E7%AF%89%E5%88%9D%E6%9C%9F%E3%82%BB%E3%83%83%E3%83%88%E3%82%A2%E3%83%83%E3%83%97%E3%83%9E%E3%83%8B%E3%83%A5%E3%82%A2%E3%83%AB)が終了していることを前提としています。

# 事前準備
KAMONOHASHIを利用するにあたり、以下を事前に設定しておく必要があります。
## AD設定
ユーザ管理にActive Directory(AD)を使用する場合、以下がADに設定されていることを確認する。

* ADのLDAP認証の許可

# テナントについて
テナントはKAMONOHASHIの管理単位である。テナント毎に、ユーザの管理、クォータ(リソースの使用量制限)の設定が行うことができます。<br>
テナントには、Gitリポジトリ、Docker Registryおよびオブジェクトストレージが関連付けられ、それぞれ複数のテナント間で共有可能です。
Gitリポジトリ、Docker Registryは1テナントに複数登録することが可能です。

初期状態では、「Sandbox」という名前のテナントが既定で用意されています。

![テナント概念(図3-1)](/assets/images/illust_tenant.png)

## テナントの作成
テナントの作成は以下のフローで行います。

1. ストレージ情報の新規登録
1. Git情報の新規登録
1. Docker Registry情報の新規登録
1. テナントの作成

ストレージ情報、Git情報、Docker Registry情報については、過去に登録したものを再度利用する場合、改めて登録しなおす必要はありません。

<a name="new_storage"></a>
### ストレージ情報の新規登録

テナントが利用するストレージの情報を登録します。
ストレージの登録には、オブジェクトストレージへ以下の操作を行う権限を持ったユーザのアクセスキーおよびシークレットキーが必要です。

* バケット追加
* 追加したバケットに対するオブジェクトの追加・取得・削除

ストレージ情報の新規登録は、以下のフローで実行できます。
1. 管理権限を持つユーザでログイン
1. [システム管理] → [ストレージ管理]を選択し、ストレージ一覧画面を表示
1. 画面右上の新規登録ボタンを押下
1. 画面に下記の情報を入力し、ストレージ情報を登録

![ストレージ登録画面(スクショ3-3)](/assets/images/admin_figure10.png)

|項目  |要否  |説明  |
|---|---|---|
|名前  |必須  |KAMONOHASHIに登録する名前。管理者が各登録情報を識別しやすいような、任意の名前を入力 |
|サーバ名URL |必須  |minioのURL<br>（例）kamonohashi.ai:9000  |
|アクセスキー |必須  |minioのアクセスキー |
|シークレットキー  |必須  |minioのシークレットキー|
|NFSサーバ |必須  | NFSサーバのホスト名またはIPアドレス |
|NFS共有ルートディレクトリ |必須  | マウントする際の共有ルートディレクトリポイント |

<a name="new_git"></a>

### Git情報の新規登録
テナントが利用するGitリポジトリの情報を登録します。

Git情報の新規登録は、以下のフローで実行できます。

1. 管理権限を持つユーザでログイン
1. [システム管理] → [Git管理]を選択し、Git一覧画面を表示
1. 画面右上の新規登録ボタンを押下
1. 画面に下記の情報を入力し、Git情報を登録

![Git新規登録画面(スクショ3-3)](/assets/images/admin_figure3.png)


|項目  |要否  |説明  |
|---|---|---|
|名前  |必須  |識別名。管理者が各登録情報を識別しやすいような、任意の名前を入力 |
|リポジトリURL  |必須  |リポジトリにgitコマンドでアクセスする際の基底URLを入力<br>（例）https://git.kamonohashi.ai:8080  |
|Git種別  |必須  |GitLabやGitHubなど、Gitサービスのプロバイダを選択  |
|トークン  |必須  |リポジトリにREST APIでアクセスする際に使用するトークンを入力。トークンの取得方法は使用するプロバイダに準じます。 |
|API URL  |必須  |リポジトリにREST APIでアクセスする際の基底URLを入力。<br>（例）https://git.kamonohashi.ai:8080  |

<a name="new_registry"></a>

### Registry情報の新規作成

テナントが利用するDocker Registryの情報を登録します。

KAMONOHASHIで利用可能なDocker Registryの条件は以下の通りです。

- DockerHub API、あるいは GitLab APIと互換性があるREST APIインターフェースがある
- KAMONOHASHIから信頼されたHTTPS通信が可能
    - ProxyないしNoProxyが適切に設定されている
    - 信頼された証明書が設定されている

Registry情報の新規登録は、以下のフローで実行できます。

1. 管理権限を持つユーザでログイン
1. [システム管理] → [レジストリ管理]を選択し、レジストリ一覧画面を表示
1. 画面右上の新規登録ボタンを押下
1. 画面に下記の情報を入力し、Docker Registry情報を登録
※DockerHub API互換の場合と、GitLab API互換の場合で、入力項目が異なります。

![Docker Registry新規登録画面(スクショ3-4)](/assets/images/admin_figure4.png)

#### DockerHub APIの場合

|項目  |要否  |説明  |
|---|---|---|
|レジストリ名  |必須  |識別名。管理者が各登録情報を識別しやすいような名前を入力。英数字およびハイフンのみが使用可能。 |
|種別  |必須  |DockerHubを選択。  |
|ホスト名  |必須  |イメージ名に使用されるレジストリのFQDNまたはIPアドレスを入力。  |
|ポート番号  |必須  |イメージ名に使用されるレジストリのポート番号を入力。  |
|API URL  |必須  |レジストリにREST APIでアクセスする際の基底URLを入力。<br>（例）https://registry-server:5555  |
|URL  |必須  |レジストリにdockerコマンドでアクセスする際の基底URLを入力。<br>（例）https://registry-server:5555  |

#### GitLab APIの場合

|項目  |要否  |説明  |
|---|---|---|
|レジストリ名  |必須  |識別名。管理者が各登録情報を識別しやすいような名前を入力。英数字およびハイフンのみが使用可能。 |
|種別  |必須  |GitLabを選択。  |
|ホスト名  |必須  |イメージ名に使用されるレジストリのFQDNまたはIPアドレスを入力。  |
|ポート番号  |必須  |イメージ名に使用されるレジストリのポート番号を入力。  |
|API URL  |必須  |レジストリにREST APIでアクセスする際の基底URLを入力。基本的にはGitLabのWeb URLと等しいです。<br>（例）https://registry-server/gitlab  |
|URL  |必須  |レジストリにdockerコマンドでアクセスする際の基底URLを入力。<br> 基本的にポート番号はWeb URLではなくレジストリのポート番号となります。<br>（例）https://registry-server:5555/gitlab  |
|プロジェクト名  |任意  |プロジェクトパスを、"オーナー名(ユーザ名またはグループ名)/プロジェクト名"の形式で入力。<br>（例）kamonohashi/sample  |

### テナントの新規作成
テナントを作成します。

テナントの新規作成は、以下のフローで実行できます。

1. 管理権限を持つユーザでログイン
1. [システム管理] → [テナント管理]を選択し、テナント一覧画面を表示
1. 画面右上の新規作成ボタンを押下
1. 画面に下記の情報を入力し、新規テナントを作成


![テナント作成画面(スクショ3-2)](/assets/images/admin_figure2.png)

|項目  |要否  |説明  |
|---|---|---|
|テナント名  |必須  |テナントを表す識別子を入力。英数字およびハイフンのみが使用可能。また更新時は変更不可。<br>（例）kamonohashi  |
|表示名  |必須  |画面等への表示名称を入力。<br>（例）カモノハシ  |
|ストレージ情報  |必須 |データファイルを格納するストレージを選択。 <br>選択肢は事前に[ストレージ情報の新規作成](#new_storage)で設定が必要。 |
|Git情報  |必須  |ジョブ実行時のユーザスクリプトを格納するGitを一つ以上選択。また、その中で既定で選択されるGitを一つ選択。<br>選択肢は事前に[Git情報の新規作成](#new_git)で設定が必要。  |
|Docker Registry情報  |必須  |ジョブ実行時のDockerイメージを格納するレジストリを選択。また、その中で既定で選択されるレジストリを一つ選択。<br>選択肢は事前に[Registry情報の新規作成](#new_registry)で設定が必要。  |

# ユーザ
ユーザはKAMONOHASHIの利用者を表し、テナントに関連付けられる。ユーザは複数のテナントに所属できます。
また、ユーザは使用する認証方式の種類によってローカルユーザ、LDAPユーザの2種類に分けられます。

## ユーザの追加とテナントへの関連付け

KAMONOHASHIではローカルユーザか、LDAPユーザかによって、ユーザの追加フローが異なります。
ただし、ユーザの種類に寄らず、ユーザ名はシステム内で一意である必要があります。

### ローカルユーザの追加

ローカルユーザの場合、KAMONOHASHI内部で認証情報を管理されます。

ユーザの新規作成は、以下のフローで実行できます。

1. 管理権限を持つユーザでログイン
1. [システム管理] → [ユーザ管理]を選択し、ユーザ一覧画面を表示
1. 画面右上の新規作成ボタンを押下
1. 画面に下記の情報を入力し、ローカルユーザを新規に追加
※ローカルユーザの場合、初期テナントの関連付けを作成時にまとめて行います。


![ユーザ新規作成画面(スクショ3-5)](/assets/images/admin_figure5.png)

|項目  |要否  |説明  |
|---|---|---|
|ユーザアカウント  |必須  |ユーザ名。システム内で一意である必要があります。英数字およびハイフンのみが使用可能。 |
|パスワード  |必須  |ユーザ認証に用いるパスワード。 |
|パスワード(再入力)  |必須  |パスワードの確認用。上記パスワードと一致している必要があります。 |
|システムロール  |任意  |追加ユーザに付与するシステムロールを選択。 |
|テナント |必須  |ユーザを関連付けるテナントを選択。複数可。 |
|テナントロール  |任意  |上記テナント項目で選択した分のテナントについて、ユーザが所有するテナントロールをそれぞれ選択。複数可。 |

### LDAPユーザの追加

LDAPユーザの場合、認証情報の管理にKAMONOHASHI外のLDAP認証サービスを利用します。
パスワード変更など、LDAPユーザの管理はKAMONOHASHI上では行えません。

LDAPユーザは、管理者ではなく、LDAPユーザ自身がKAMONOHASHIにログインすることで追加できます。
ユーザがLDAPサービスに登録されているユーザ名とパスワードでKAMONOHASHIにログインすると、KAMONOHASHI内にユーザ情報が登録され、Sandboxテナントに自動で関連付けられます。

LDAPユーザに対して、システムロールの付与や、Sandbox以外のテナントへの関連付けを行う場合、下記の処理を実行します。

1. ユーザがLDAPサービスに登録されているユーザ名とパスワードでKAMONOHASHIにログイン
    * KAMONOHASHI内にユーザ情報が登録される
    * 既定ではSandboxテナントに自動で関連付けられる
1. 管理権限を持つユーザが、[システム管理] → [ユーザ管理]を選択し、ユーザ一覧画面を表示
1. 追加されているLDAPユーザ名を一覧から探し、列を選択
1. 表示されたユーザ編集画面で、ローカルユーザの場合と同様に、システムロールと関連付けるテナントおよびそのテナントロールをそれぞれ選択

## ロール
ユーザにロールを付与することで、操作可能な機能を制御できます。
一人のユーザには複数のロールを関連付けられます。

ロールは大きく以下の2種類に大別されます。

* システムロール
    * テナントを横断する、システム全体に関連した情報を取り扱うためのロール
    * 既定では全てのシステム管理権限がある「Adminロール」が使用できます
* テナントロール
    * 特定のテナント内に限定された情報を扱うためのロール
    * 所属するテナントごとに、ユーザに付与するテナントロールを指定
        * 例えば、同一のユーザに対し、AテナントにはManagerロールを付与し、BテナントにはUserロールとResercherロールを付与する、など
    * 既定では以下の3種類のテナントロールが使用できます

|ロール  |説明  |
|---|---|
|User  |データの追加・削除、およびデータセットの作成・変更を行う権限を持ちます。  |
|Researcher  |ジョブの実行、結果の評価を行う権限を持ちます。  |
|Manager  |そのテナント内で使用する計算リソースや権限の管理を行う権限を持ちます。  |

# ノード

ノードとは、KAMONOHASHIに管理される物理的あるいは仮想的な計算用コンピュータを指します。
KAMONOHASHI自体を構成する管理サーバ群は含みません。

<a name="new_node"></a>

## ノードの追加
KAMONOHASHIの管理下に新しくノードを追加します。

ノードの新規登録画面は、以下のフローで表示できます。

1. 管理権限を持つユーザでログイン
1. [システム管理] → [ノード管理]を選択し、ノード一覧画面を表示
1. 画面右上の新規作成ボタンを押下
1. 画面に下記の情報を入力し、ノードを新規に追加

![ノード新規作成画面(スクショ3-6)](/assets/images/admin_figure6.png)


|項目  |要否  |説明  |
|---|---|---|
|名前  |必須  |ノード名。システム内で一意である必要があります。英数字およびハイフンのみが使用可能。 |
|メモ  |任意  |管理用のメモを自由に入力できます。 |
|パーティション |任意  |ノードにパーティションを設定できます。パーティションについての詳細は後述。 |
|アクセスレベル |任意  |ノードへのアクセスレベルを設定できます。アクセスレベルについての詳細は後述。Privateを選択した場合、アクセスを許可するテナントを選択するUIが表示されます。指定しなかった場合はDisabledが設定されます。 |
|TensorBoard実行可否 |任意  |ノード上でTensorBoardコンテナの実行を許可するか指定できます。 |

# おわりに
これで、KAMONOHASHIを用いた学習をする準備が整いました。

[チュートリアル](/tutorial/)や[ユーザーガイド](/docs/user)を参考にKAMONOHASHIを用いたAI開発を開始しましょう！